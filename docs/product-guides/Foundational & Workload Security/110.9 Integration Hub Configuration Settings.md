# Integration Hub

## Installation Answer File

```yaml
# Default values for IHUB.

nameOverride: "" # The name for IHUB chart<br> (Default: `.Chart.Name`)
controlPlaneHostname: <user input> # K8s control plane IP/Hostname<br> (**REQUIRED**)
k8sApiServerPort: <user input>

# Warning: Ensure that the naming is applied consistently for all dependent services when modifying nameOverride
# TODO: Services should be be able to be deployed in different namespaces
dependentServices: # The dependent Service Name for deploying  IHUB chart, default is the chart name and override is from nameOverride value.
  cms: cms
  aas: aas
  hvs: hvs
  iseclController: isecl-controller
  
image:
  svc:
    name: <user input> # The image name with which IHUB image is pushed to registry<br> (**REQUIRED**)
    pullPolicy: Always  # The pull policy for pulling from container registry for IHUB<br> (Allowed values: `Always`/`IfNotPresent`)
    imagePullSecret:  # The image pull secret for authenticating with image registry, can be left empty if image registry does not require authentication
    initName: <user input> # The image name of init container

secret:
  serviceUsername: ihubAdminUser # Admin Username for IHUB
  servicePassword: ihubAdminPass # Admin Password for IHUB

hostAliasEnabled: false # Set this to true for using host aliases and also add entries accordingly in ip, hostname entries. hostalias is required when ingress is deployed and pods are not able to resolve the domain names
aliases:
  hostAliases:
    - ip: ""
      hostnames:
        - ""
        - ""

storage:
  nfs:
    server: <user input> # The NFS Server IP/Hostname<br> (**REQUIRED**)
    reclaimPolicy: Retain  # The reclaim policy for NFS<br> (Allowed values: `Retain`/)
    accessModes: ReadWriteMany # The access modes for NFS<br> (Allowed values: ReadWriteMany)
    path: /mnt/nfs_share # The path for storing persistent data on NFS
    configSize: 10Mi # The configuration size for storing config for IHUB in NFS path
    logsSize: 1Gi # The logs size for storing logs for IHUB in NFS path
    baseSize: 1.1Gi # The base volume size (configSize + logSize)
 
securityContext:
  init: # The fsGroup id for init containers
    fsGroup: 1001 
  ihub: # The security content for IHUB Pod
    runAsUser: 1001
    runAsGroup: 1001
    capabilities:
      drop:
        - all
    allowPrivilegeEscalation: false

service:
  directoryName: ihub
  cms:
    containerPort: 8445 # The containerPort on which CMS can listen
  aas: 
    containerPort: 8444 # The containerPort on which AAS can listen
    port: 30444 # The externally exposed NodePort on which AAS can listen to external traffic
  hvs:
    containerPort: 8443 # The containerPort on which HVS can listen 


```

## Configuration Options

```
config-file: /etc/ihub/config
log:
  max-length: 1500
  enable-stdout: true
  level: trace
ihub:
  service-username: admin@hub
  service-password: hubAdminPass
  poll-interval-minutes: 1
aas:
  url: https://<aas_ip>:8444/aas/v1
cms:
  url: https://<cms_ip>:8445/cms/v1/
  tls-cert-digest: 8a035e3cdd...
attestation-service:
  attestation-url: https://<hvs_ip>:8443/hvs/v2
  attestation-type: HVS
end-point:
  type: KUBERNETES or OPENSTACK
  url: https://<kubernetes_ip>:6443/ or OpenStack Nova URL
  crd-name: custom-isecl
  token: eyJhbGciOiJSUzI...
  username: OpenStack Username
  password: OpenStack Password
  auth-url: OpenStack Authentication URL
  cert-file: /etc/ihub/apiserver.crt
tls:
  cert-file: /etc/ihub/tls-cert.pem
  key-file: /etc/ihub/tls-key.pem
  common-name: Integration Hub TLS Certificate
  san-list: 127.0.0.1,localhost
```

Available setup task for IHub
    all                                 Runs all setup tasks
    download-ca-cert                    Download CMS root CA certificate
    download-cert-tls                   Download CA certificate from CMS for tls
    attestation-service-connection      Establish Attestation service connection
    tenant-service-connection           Establish Tenant service connection
    create-signing-key                  Create signing key for IHUB
    download-saml-cert                  Download SAML certificate from Attestation service
    update-service-config               Sets or Updates the Service configuration
Following environment variables are required for update-service-config setup:
    SERVICE_USERNAME    The service username as configured in AAS
    SERVICE_PASSWORD    The service password as configured in AAS
    LOG_LEVEL           Log level
    LOG_MAX_LENGTH      Max length of log statement
    LOG_ENABLE_STDOUT   Enable console log
    AAS_BASE_URL        AAS Base URL

Following environment variables are required for download-ca-cert
    CMS_BASE_URL                CMS base URL in the format https://{{cms}}:{{cms_port}}/cms/v1/
    CMS_TLS_CERT_SHA384         SHA384 hash value of CMS TLS certificate

Following environment variables are required in download-cert-tls
    CMS_BASE_URL        CMS base URL in the format https://{{cms}}:{{cms_port}}/cms/v1/
    BEARER_TOKEN        Bearer token for accessing CMS api
Following environment variables are optionally used in download-cert-tls
    TLS_CERT_FILE       The file to which certificate is saved
    TLS_KEY_FILE        The file to which private key is saved
    TLS_COMMON_NAME     The common name of signed certificate

    TLS_SAN_LIST        Comma separated list of hostnames to add to Certificate, including IP addresses and DNS names

Following environment variables are required for attestation-service-connection setup:
    HVS_BASE_URL        Base URL for the Host Verification Service
    SHVS_BASE_URL       Base URL for the SGX Host Verification Service

Following environment variables are required for tenant-service-connection setup:
    TENANT      Type of Tenant Service (Kubernetes)
Following environment variables are required for Kubernetes tenant:
    KUBERNETES_URL              URL for Kubernetes deployment
    KUBERNETES_CRD              CRD Name for Kubernetes deployment
    KUBERNETES_TOKEN            Token for Kubernetes deployment
    KUBERNETES_CERT_FILE        Certificate path for Kubernetes deployment