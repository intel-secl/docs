# Trust Agent

## Installation Answer File Options

```yaml
# Default values for TA.

nameOverride: "" # The name for TA chart<br> (Default: `.Chart.Name`)
controlPlaneHostname: <user input> # K8s control plane IP/Hostname<br> (**REQUIRED**)
nodeLabel: 
  txt: "" # The node label for TXT-ENABLED hosts<br> (**REQUIRED IF NODE IS TXT ENABLED**)
  suefi: "" # The node label for SUEFI-ENABLED hosts (**REQUIRED IF NODE IS SUEFI ENABLED**)

# Warning: Ensure that the naming is applied consistently for all dependent services when modifying nameOverride
# TODO: Services should be be able to be deployed in different namespaces
dependentServices: # The dependent Service Name for deploying  TA chart, default is the chart name and override is from nameOverride value.
  cms: cms
  aas: aas
  hvs: hvs
  nats: nats
  
image:
  svc:
    name: <user input> # The image name with which TA image is pushed to registry<br> (**REQUIRED**)
    pullPolicy: Always  # The pull policy for pulling from container registry for TA<br> (Allowed values: `Always`/`IfNotPresent`)
    imagePullSecret:  # The image pull secret for authenticating with image registry, can be left empty if image registry does not require authentication
    initName: <user input> # The image name of init container

config:
  logLevel: info  # Log Level for Trust agent<br> (Allowed values: `info`/`warn`/`debug`/`trace`)
  provisionAttestation: "y" # TPM provisioning<br> (Allowed values: `y`\`n`)
  tpmOwnerSecret:  # The TPM owner secret if TPM is already owned
  nats:
    enabled: false # Enable/Disable NATS mode<br> (Allowed values: `true`\`false`)
    servers: <user input> # NATS Server IP/Hostname  
    serviceMode: <user input> # The model for TA<br> (Allowed values: `outbound`)

hostAliasEnabled: false # Set this to true for using host aliases and also add entries accordingly in ip, hostname entries. hostalias is required when ingress is deployed and pods are not able to resolve the domain names
aliases:
  hostAliases:
    - ip: ""
      hostnames:
        - ""
        - ""

service:
  directoryName: trustagent
  cms:
    containerPort: 8445 # The containerPort on which CMS can listen
  aas: 
    containerPort: 8444 # The containerPort on which AAS can listen
  hvs:
    containerPort: 8443 # The containerPort on which HVS can listen
    port: 30443
  ta:
    containerPort: 1443 # The containerPort on which TA can listen
    port: 31443 # The externally exposed NodePort on which TA can listen to external traffic


```

## Configuration Options

The Trust Agent configuration settings are managed in
`/opt/trustagent/configuration/config.yml`

| **Setting**                                   | **Description**                                              |
| --------------------------------------------- | ------------------------------------------------------------ |
| tpmquoteipv4: true                            | When enabled, the Trust Agent will perform an additional hash of the nonce using the bytes from the Trust Agent server IP when returning TPM quotes. This should always be set to True. |
| logging:                                      |                                                              |
| loglevel: info                                | Defines the Trust Agent logging level                        |
| logenablestdout: false                        | If set to True, the Trust Agent will log to stdout. By default this is False and the logs are sent to /var/log/trustagent/trustagent.log |
| logentrymaxlength: 300                        | Defines the maximum length of a single log entry             |
| webservice:                                   |                                                              |
| port: 1443                                    | Defines the port on which the Trust Agent API server will listen |
| readtimeout: 30s                              |                                                              |
| readheadertimeout: 10s                        |                                                              |
| writetimeout: 10s                             |                                                              |
| idletimeout: 10s                              |                                                              |
| maxheaderbytes: 1048576                       |                                                              |
| hvs:                                          |                                                              |
| url: https://0.0.0.0:8443/hvs/v2              | Defines the baseurl for the Verification Service             |
| tpm:                                          |                                                              |
| aas:                                          |                                                              |
| baseurl: https://0.0.0.0:8444/aas/v1/         | Defines the base URL for the AAS                             |
| cms:                                          |                                                              |
| baseurl: https://0.0.0.0:8445/cms/v1          | Defines the base URL for the CMS                             |
| tlscertdigest: 330086b3...ae477c8502          | Defines the SHA383 hash of the CMS TLS certificate           |
| tls:                                          |                                                              |
| certsan: 10.1.2.3,server.domain.com,localhost | Comma-separated list of hostnames and IP addresses for the Trust Agent. Used in the Agent TLS certificate. |
| certcn: Trust Agent TLS Certificate           | Common Name for the Trust Agent TLS certificate              |


## Directory Layout

The Linux Trust Agent installs by default to `/opt/trustagent`, with the
following subfolders:

#### Bin

Contains executables and scripts.

#### Configuration

Contains the `config.yml` configuration file, as well as certificates and
keystores. This includes the AIK public key blob after provitioning.

#### Var

Contains information gathered from the platform and SOFTWARE Flavor
manifests. All files with the name `manifest_*.xml` will be parsed to
define measurements during boot. Generally these should be automatically
provisioned from the Verification Service when creating/deploying
SOFTWARE Flavors.