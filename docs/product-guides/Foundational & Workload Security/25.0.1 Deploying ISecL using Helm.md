### Deploying Intel SecL-DC

Beginning in the 4.2 release, Intel SecL-DC is deployed using Helm charts onto a Kubernetes platform.  Deployment using binary installers has been deprecated.

### Prerequisites for Deployment

- A Kubernetes cluster (version 1.22.2 or higher) must be available.  Hosts to be attested should be worker nodes in the Kubernetes cluster.  Ensure that kubectl is configured to work from the system where you will execute the deployment.  For default installations, a multi-node cluster (at least one controller node and at least one worker node) is recommended.  A single-node installation (all Kubernetes services and all workloads running on a single node, as in microk8s) will require adjustments to node labels and pod tolerations.  Worker nodes to be attested must meet the hardware security technology requirements for the use cases to be enabled.
- Helm 3 must be installed on the system from which the deployment will be launched. 
  
  ```
  curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3
  chmod 700 get_helm.sh
  ./get_helm.sh 
  ```

- And NFS server is required with at minimum 2Gi of storage space available (10Gi is recommended for large deployments).

### Retrieving Helm charts

The Intel SecL-DC Helm charts are hosted in a github Helm repo:

```
helm repo add isecl-helm https://intel-secl.github.io/helm-charts/
helm repo update
```

The list of available charts on the added repo can be shown using the "search repo" command:

``` 
helm search repo
```

### Persistent Storage

Several Intel SecL-DC services require persistent storage for databases, configuration settings, and logs.  By default the Helm deployments are configured to use NFS storage for these persistent volumes.

On the NFS server, execute the provided setup-nfs.sh script to set up the needed persistent volume folder structure and share the mount points.

```
 curl -fsSL -o setup-nfs.sh https://raw.githubusercontent.com/intel-secl/helm-charts/v4.2.0-Beta/setup-nfs.sh
 chmod +x setup-nfs.sh
./setup-nfs.sh /mnt/nfs_share 1001 <ip or hostname of the control plane>
```

---
**NOTE**
Persistent storage will not be deleted if the Helm deployment is uninstalled.  Be sure to delete the created folders on the NFS server (/mnt/nfs_share/ by default) as well as the local storage used by the Trust Agent (/opt/trustagent and /var/log/trustagent on each worker node) if a "fresh" installation is needed.  Rerun the setup-nfs.sh script after deleting the shared folders to recreate the empty folder structure.
---

